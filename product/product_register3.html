<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>본인인증</title>
    <link rel="stylesheet" href="../css/common/product_header_style.css">
    <link rel="stylesheet" href="../css/product/product_register3.css">
    <link rel="stylesheet" href="../css/common/footer_style.css">
</head>

<body>
    <div id="header"></div>

    <main class="content">
        <section class="verify-wrap">
            <h1 class="verify-title"><strong>사용자</strong> 님, 본인인증을 진행해 주세요.</h1>

            <!-- 인증수단 탭 -->
            <div class="method-tabs">
                <button class="tab on">휴대폰</button>
            </div>

            <div class="divider"></div>

            <!-- 약관 -->
            <section class="terms">
                <button type="button" class="terms-head" id="termsToggle">
                    <span class="left">
                        <!-- 여기에서 ✓ 텍스트 제거 -->
                        <span class="bullet"></span>
                        (필수)휴대폰 인증 약관 동의
                    </span>
                    <span class="chev">›</span>
                </button>
                <div class="terms-body" id="termsBody">
                    <ul>
                        <li>개인정보 수집 및 이용 동의</li>
                        <li>고유식별정보 처리 동의</li>
                        <li>통신사 이용약관 동의</li>
                        <li>서비스 이용약관 동의</li>
                    </ul>
                </div>
            </section>

            <!-- 휴대폰 번호 -->
            <div class="form-item phone-line">
                <label for="phone">휴대폰번호</label>
                <div class="inline-field">
                    <input id="phone" type="text" inputmode="numeric" maxlength="11" placeholder="숫자만 입력해 주세요.">
                    <button type="button" class="btn-ghost" id="reqBtn">재요청</button>
                </div>
                <div class="underline"></div>
            </div>

            <!-- 인증번호 -->
            <div class="form-item code-line">
                <label for="code">인증번호 6자리</label>
                <div class="inline-field">
                    <input id="code" type="text" inputmode="numeric" maxlength="6" placeholder="">
                    <span class="timer" id="timer">02:58</span>
                </div>
                <div class="underline"></div>
            </div>

            <!-- 안내 -->
            <ul class="notes">
                <li>인증번호를 발송했습니다.(유효 시간 3분)</li>
                <li>인증번호가 오지 않는 경우 입력한 정보가 정확한지 확인해 주세요.</li>
                <li><u>본인 인증에 사용한 휴대폰 번호로 회원정보가 자동 변경 · 저장됩니다.</u></li>
            </ul>

            <!-- 제출 -->
            <button class="btn-submit" id="submitBtn" disabled>확인</button>
        </section>
    </main>

    <div id="footer"></div>

    <!-- JS 하나로 합친 버전 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            /* header/footer 로드 */
            fetch('../common/product_header.html')
                .then(r => r.text())
                .then(h => {
                    document.getElementById('header').innerHTML = h;
                });
            fetch('../common/footer.html')
                .then(r => r.text())
                .then(h => {
                    document.getElementById('footer').innerHTML = h;
                });

            /* 탭 */
            document.querySelectorAll('.method-tabs .tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.method-tabs .tab').forEach(b => b.classList.remove('on'));
                    btn.classList.add('on');
                });
            });

            const code = document.getElementById('code');
            const submit = document.getElementById('submitBtn');

            /* 휴대폰: 숫자만/11자리 */
            const phone = document.getElementById('phone');
            phone.addEventListener('input', function () {
                let v = this.value.replace(/\D/g, '').slice(0, 11);
                this.value = v;
            });

            /* === 약관 체크 & 펼치기 === */
            const head = document.getElementById('termsToggle');     // .terms-head 버튼
            const body = document.getElementById('termsBody');       // 약관 내용 박스
            const left = head.querySelector('.left');                // 텍스트+동그라미 영역
            const bullet = head.querySelector('.bullet');            // 동그라미
            const chev = head.querySelector('.chev');                // 화살표

            // 초기 상태 : 접힘
            body.classList.remove('open');
            head.setAttribute('role', 'switch');
            head.setAttribute('aria-checked', 'false');
            head.setAttribute('aria-expanded', 'false');

            // 버튼 활성화 조건: '필수 약관 체크' && '인증번호 6자리'
            function refreshSubmit() {
                const termsChecked = bullet.classList.contains('on');
                const codeOk = code.value.replace(/\D/g, '').length === 6;
                submit.disabled = !(termsChecked && codeOk);
            }

            // 왼쪽(동그라미/문구) 클릭 → 체크 토글만
            left.addEventListener('click', (e) => {
                e.stopPropagation();
                const on = bullet.classList.toggle('on');
                head.setAttribute('aria-checked', on ? 'true' : 'false');
                refreshSubmit();
            });

            // 오른쪽 화살표 클릭 → 스르륵 펼치기/접기만
            chev.addEventListener('click', (e) => {
                e.stopPropagation();
                const opened = head.getAttribute('aria-expanded') === 'true';

                if (opened) {
                    head.setAttribute('aria-expanded', 'false');
                    head.classList.remove('open');
                    body.classList.remove('open');
                } else {
                    head.setAttribute('aria-expanded', 'true');
                    head.classList.add('open');
                    body.classList.add('open');
                }
            });

            /* 인증번호: 숫자만/6자리 */
            code.addEventListener('input', function () {
                let v = this.value.replace(/\D/g, '').slice(0, 6);
                this.value = v;
                refreshSubmit();
            });

            /* 타이머 (3분) */
            let leftSec = 178; // 02:58 (예시 시작값)
            const timerEl = document.getElementById('timer');
            let timer = setInterval(() => {
                const m = String(Math.floor(leftSec / 60)).padStart(2, '0');
                const s = String(leftSec % 60).padStart(2, '0');
                timerEl.textContent = `${m}:${s}`;
                if (leftSec-- <= 0) {
                    clearInterval(timer);
                    submit.disabled = true;      // 만료 시 무조건 비활성화
                    timerEl.textContent = "00:00";
                }
            }, 1000);

            /* 재요청: 타이머 리셋 */
            document.getElementById('reqBtn').addEventListener('click', () => {
                clearInterval(timer);
                leftSec = 180;
                timer = setInterval(() => {
                    const m = String(Math.floor(leftSec / 60)).padStart(2, '0');
                    const s = String(leftSec % 60).padStart(2, '0');
                    timerEl.textContent = `${m}:${s}`;
                    if (leftSec-- <= 0) {
                        clearInterval(timer);
                        submit.disabled = true;
                        timerEl.textContent = "00:00";
                    }
                }, 1000);
            });

            // 초기 버튼 상태 반영
            refreshSubmit();
        });
    </script>
</body>

</html>