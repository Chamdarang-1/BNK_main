<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>카드신청 - 기본 정보</title>
    <link rel="stylesheet" href="../css/common/product_header_style.css" />
    <link rel="stylesheet" href="../css/product/product_register2.css" />
    <link rel="stylesheet" href="../css/common/footer_style.css" />
</head>

<body>
    <div id="header"></div>

    <main class="content">
        <section class="apply-form-wrap">
            <div class="apply-form-box">
                <header class="apply-form-header">
                    <h1>기본 정보 입력 후 동의 여부를 확인해 주세요</h1>

                    <!-- 국적 선택 드롭다운 -->
                    <div class="nation-select-wrap">
                        <button type="button" class="nation-select" id="nationBtn">
                            <span id="nationLabel">내국인</span>
                            <span class="chev">▼</span>
                        </button>
                        <ul class="nation-list" id="nationList">
                            <li data-value="내국인">내국인</li>
                            <li data-value="외국인">외국인</li>
                        </ul>
                    </div>
                </header>

                <div class="apply-form-body">
                    <!-- 이름 -->
                    <div class="form-item">
                        <label for="name">이름</label>
                        <input id="name" type="text" placeholder="이름을 입력해 주세요." />
                    </div>

                    <!-- 영문 이름 -->
                    <div class="form-2col">
                        <div class="form-item">
                            <label for="ename-last">영문 성</label>
                            <input id="ename-last" type="text" placeholder="KIM" />
                        </div>
                        <div class="form-item">
                            <label for="ename-first">영문 이름</label>
                            <input id="ename-first" type="text" placeholder="CHEOLSU" />
                            <p class="field-help">여권과 동일한 영문명을 입력해 주세요.</p>
                        </div>
                    </div>

                    <!-- 주민등록번호 -->
                    <div class="form-item">
                        <label>주민등록번호</label>
                        <div class="rrn-field">
                            <!-- 앞 6자리 -->
                            <input type="text" class="rrn-front" inputmode="numeric" maxlength="6"
                                placeholder="생년월일 6자리">

                            <span class="dash">-</span>

                            <!-- 뒤 7자리 (마스킹) -->
                            <input type="text" class="rrn-back secret-input" inputmode="numeric" maxlength="7"
                                aria-label="주민등록번호 뒤 7자리 입력">
                        </div>
                    </div>

                    <!-- 휴대폰번호 -->
                    <div class="form-item">
                        <label for="phone">휴대폰번호</label>
                        <input id="phone" type="text" inputmode="numeric" maxlength="11" placeholder="숫자만 입력해 주세요.">
                    </div>

                    <!-- 이메일  -->
                    <div class="form-item">
                        <label for="email">이메일</label>
                        <input id="email" type="text" placeholder="이메일을 입력해 주세요." />
                    </div>

                    <!-- ===== 약관 동의 영역 (기억해둔 패턴) ===== -->
                    <section class="agree-section">
                        <!-- 전체 동의 -->
                        <div class="agree-all-row">
                            <button type="button" class="agree-all-btn" aria-pressed="false">
                                <span class="agree-check" aria-hidden="true"></span>
                                <span class="agree-all-title">전체 동의</span>
                            </button>
                            <p class="agree-all-desc">아래 개인정보(신용)정보 필수/선택 동의 항목에 모두 동의합니다.</p>
                        </div>

                        <!-- 리스트 박스 -->
                        <div class="agree-list-box">
                            <!-- 1. 개인정보(신용)정보 필수적 동의 (필수) -->
                            <div class="agree-row required">
                                <div class="agree-head" aria-expanded="false">
                                    <span class="left">
                                        <span class="agree-check" aria-hidden="true"></span>
                                        개인정보(신용)정보 필수적 동의 (필수)
                                    </span>
                                    <span class="right" aria-hidden="true">›</span>
                                </div>
                                <div class="agree-body">
                                    <ul>
                                        <li>개인(신용)정보 필수적 수집·이용에 관한 사항</li>
                                        <li>고유식별정보 필수적 수집·이용에 관한 사항</li>
                                        <li>개인(신용)정보 조회에 관한 사항</li>
                                        <li>고유식별정보 조회에 관한 사항</li>
                                        <li>개인(신용)정보 필수적 제공에 관한 사항</li>
                                        <li>고유식별정보 필수적 제공에 관한 사항</li>
                                        <li>(통신단말장치) 개인(신용)정보 수집·이용에 관한 사항</li>
                                        <li>(통신단말장치) 고유식별정보 수집·이용에 관한 사항</li>
                                        <li>(통신단말장치) 개인(신용)정보 제공에 관한 사항</li>
                                        <li>(통신단말장치) 고유식별정보 제공에 관한 사항</li>
                                        <li>개인(신용)정보 필수적 제공에 관한 사항(상품서비스)</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 2. 선택적 동의 (선택) -->
                            <div class="agree-row">
                                <div class="agree-head" aria-expanded="false">
                                    <span class="left">
                                        <span class="agree-check" aria-hidden="true"></span>
                                        개인(신용)정보 선택적 동의 (선택)
                                    </span>
                                    <span class="right" aria-hidden="true">›</span>
                                </div>
                                <div class="agree-body">
                                    <p class="agree-body-desc">
                                        동의 시 편의 제공(사은품, 할인 쿠폰 등), 신상품(서비스)소개, 발급 관련 편의(심사 우대, 미열료 및 발급 불가 안내) 등
                                        다양한 혜택을 안내해 드립니다. 미동의 시에도 카드 발급이 가능합니다.
                                    </p>
                                    <ul>
                                        <li>카드 상품 안내 및 이용 권유를 위한 수집·이용</li>
                                        <li>카드 상품 이외의 부가서비스 안내 등을 위한 수집·이용</li>
                                        <li>업무 제휴 계약을 체결한 제휴업체에 분석 및 마케팅 목적 제공</li>
                                        <li>전자적 전송매체를 통한 광고성 정보 수신 동의</li>
                                        <li>카카오톡 메시지 수신 동의</li>
                                        <li>앱 PUSH 동의</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 3. 카드 신청 관련 안내 필수적 동의 (필수/본문 없음) -->
                            <div class="agree-row required">
                                <div class="agree-head" aria-expanded="false">
                                    <span class="left">
                                        <span class="agree-check" aria-hidden="true"></span>
                                        카드 신청 관련 안내 필수적 동의 (필수)
                                    </span>
                                    <!-- 본문이 없으니 화살표는 출력만, 동작은 없음 -->
                                    <span class="right" aria-hidden="true">›</span>
                                </div>
                            </div>
                        </div>

                        <button class="btn-submit" id="submitBtn" disabled>확인</button>
                    </section>
                </div>
            </div>
        </section>
    </main>

    <div id="footer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            /* 1) 헤더/푸터 로드 */
            fetch('../common/product_header.html')
                .then(res => res.text())
                .then(html => {
                    document.getElementById('header').innerHTML = html;
                    const headerEl = document.querySelector('.header');
                    if (headerEl) {
                        window.addEventListener('scroll', () => {
                            if (window.scrollY > 10) headerEl.classList.add('scrolled');
                            else headerEl.classList.remove('scrolled');
                        });
                    }
                });

            fetch('../common/footer.html')
                .then(res => res.text())
                .then(html => (document.getElementById('footer').innerHTML = html));

            /* 2) 내/외국인 드롭다운 */
            const btn = document.getElementById('nationBtn');
            const list = document.getElementById('nationList');
            const label = document.getElementById('nationLabel');

            if (btn && list && label) {
                btn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const isOpen = list.style.display === 'block';
                    list.style.display = isOpen ? 'none' : 'block';
                });

                list.addEventListener('click', function (e) {
                    const li = e.target.closest('li');
                    if (!li) return;
                    label.textContent = li.dataset.value;
                    list.style.display = 'none';
                });

                document.addEventListener('click', function () {
                    list.style.display = 'none';
                });
            }

            /* 3) 휴대폰 11자리 숫자만 */
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function () {
                    let onlyNum = this.value.replace(/\D/g, '');
                    if (onlyNum.length > 11) onlyNum = onlyNum.slice(0, 11);
                    this.value = onlyNum;
                });
            }

            /* 4) 약관 동의 (전체동의 + 개별동의 + 스르륵 펼침) */
            const allBtn = document.querySelector('.agree-all-btn');
            const allCheck = document.querySelector('.agree-all-btn .agree-check');
            const rows = document.querySelectorAll('.agree-row');
            const submitBtn = document.getElementById('submitBtn');

            // 필수 약관 모두 체크됐는지
            function refreshSubmit() {
                const requiredChecks = document.querySelectorAll('.agree-row.required .agree-head .agree-check');
                const allRequiredOn = Array.from(requiredChecks).every(c => c.classList.contains('on'));
                if (submitBtn) submitBtn.disabled = !allRequiredOn;
            }

            // 전체동의 아이콘 + 버튼 상태 동기화
            function syncAllAndButton() {
                const everyOn = Array.from(rows)
                    .every(r => {
                        const icon = r.querySelector('.agree-head .agree-check');
                        return icon && icon.classList.contains('on');
                    });

                if (allCheck) {
                    allCheck.classList.toggle('on', everyOn);
                }
                refreshSubmit();
            }

            // 개별 행 설정
            rows.forEach(row => {
                const head = row.querySelector('.agree-head');
                const left = head ? head.querySelector('.left') : null;           // 체크/문구 영역
                const chev = head ? head.querySelector('.right') : null;          // 펼치기 화살표
                const chk = head ? head.querySelector('.agree-check') : null;     // 동그라미
                const body = row.querySelector('.agree-body');                    // 상세 내용 (없을 수도 있음)

                if (!head || !left || !chk) return;

                // 초기 상태 : 접힘
                if (body) {
                    head.setAttribute('aria-expanded', 'false');
                    body.classList.remove('open'); // CSS에서 max-height 0 상태
                }

                // 왼쪽(동그라미+문구) 클릭 → 체크 토글만
                left.addEventListener('click', (e) => {
                    e.stopPropagation();
                    chk.classList.toggle('on');

                    // 전체 동의와 동기화
                    const everyOn = Array.from(document.querySelectorAll('.agree-row .agree-head .agree-check'))
                        .every(c => c.classList.contains('on'));
                    if (allCheck) {
                        allCheck.classList.toggle('on', everyOn);
                    }

                    refreshSubmit();
                });

                // 오른쪽 화살표 클릭 → 상세 펼치기/닫기만 (본문 있는 경우에만)
                if (chev && body) {
                    chev.style.cursor = 'pointer';
                    chev.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const opened = head.getAttribute('aria-expanded') === 'true';
                        if (opened) {
                            head.setAttribute('aria-expanded', 'false');
                            body.classList.remove('open');   // 접기
                        } else {
                            head.setAttribute('aria-expanded', 'true');
                            body.classList.add('open');      // 펼치기
                        }
                    });
                }
            });

            // 전체 동의 버튼 → 모든 동그라미 on/off (펼치기 상태는 그대로)
            if (allBtn && allCheck) {
                allBtn.addEventListener('click', () => {
                    const willCheck = !allCheck.classList.contains('on');
                    allCheck.classList.toggle('on', willCheck);

                    rows.forEach(row => {
                        const icon = row.querySelector('.agree-head .agree-check');
                        if (icon) {
                            icon.classList.toggle('on', willCheck);
                        }
                    });

                    refreshSubmit();
                });
            }

            // 초기 상태 반영
            refreshSubmit();
        });
    </script>

</body>

</html>